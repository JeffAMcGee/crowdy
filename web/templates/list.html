{% extends 'base.html' %}

{% block head_extra %}

<script src="/static/scripts/arbor.js"></script>  
<script src="/static/scripts/crowd_network.js"></script>  

<script>
image0 =new Image();
image1 =new Image();
//image0.src ="http://students.cse.tamu.edu/pka293/yellow_star.jpg"
image0.src ="/static/images/yellow_star.jpg"
//image1.src ="http://students.cse.tamu.edu/pka293/red_star.jpg"
image1.src ="/static/images/red_star.jpg"
function image_click(imageid)
{
var i=imageid
imgs=document.getElementsByTagName('img');
//var j=document.images(i);
//alert(imgs)
for(j in imgs)
 {
  if(imgs[j].id==i)
  {
   //alert(imgs[j].id)
   if(imgs[j].src==image1.src)
    {
	imgs[j].src=image0.src
	break;
    }
    else
    {
	imgs[j].src=image1.src
	break;
    }
  }
 }
//j.setAttribute('src', image0.src);
}
function loadData(data) {
	var events = jQuery.map(data, function(crowd,i) {
        return {
            'start': new Date(1000*crowd.start),
            'end': new Date(1000*crowd.end),
	    'users': crowd.users,
            'title': crowd._id,
            'description': 'a crowd of '+crowd.size+' people',
	    'size': crowd.size,
	    /*if (crowd.size==4)
	    {
		'star':image0.src
	    }
	    else
	    {
		'star':image1.src
	    }*/
	    'star' : crowd.star
	    'starred': image1.src
        };
        });
        var jq_tbo = $('#dyTableBody');
	var tbo=document.getElementById('dyTableBody');
	for(var i=0;i<events.length;i++){
		row=document.createElement('tr');
		for(var j=0;j<3;j++){
			cell=document.createElement('td');
			switch(j)
			{
				case 0: 
					var date1 = events[i]['start'];
					var date2 = events[i]['end'];
					cell.appendChild(document.createTextNode(date1.getFullYear()+'/'+date1.getMonth()+'/'+date1.getDate()+' '+date1.getHours()+':'+date1.getMinutes()+' To '+date2.getFullYear()+'/'+date2.getMonth()+'/'+date2.getDate()+' '+date2.getHours()+':'+date2.getMinutes())); 
					break;
				case 1: cell.appendChild(document.createTextNode(events[i]['title'])); break;
				case 2: cell.appendChild(document.createTextNode(events[i]['description'])); break;
			}
			row.appendChild(cell);
		}
		//<a href="http://www.w3schools.com">
		//<img src=events[i]['star'] id=events[i]['title'] width="32" height="32">
		cell1=document.createElement('img');
		/*if (events[i]['star']==false)
	    	{
			events[i]['starred']=image0.src;
	    	}
	    	else
	    	{
			events[i]['starred']=image1.src;
	    	}*/
		cell1.setAttribute('src', events[i]['starred']);
		cell1.setAttribute('id', events[i]['title']+"img");
		//cell1.setAttribute('href', 'http://www.google.com');
		cell1.setAttribute('onclick', image_click(events[i]['title']+"img"));
		cell1.setAttribute('height', '30px');
		cell1.setAttribute('width', '30px');
		
		row.appendChild(cell1);
		//alert(document.getElementById(events[i]['title']+"img").href)
                tbo.appendChild(row);
                //toggle the detailed view when the user clicks a row
                jq_tbo.children().last().click(
                    {cid:events[i]['title']},
                    function(e) {
                        var detail = $(this).next();
                        detail.slideToggle();
                        var td = detail.children().first();
                        if(!td.contents.length==0) {
                          td.load('/crowd/'+e.data.cid,function() {
                              loadCrowdPopup(e.data.cid, detail);
                          });
                        }
                    }
                );
		
                jq_tbo.append('<tr style="display:none"><td colspan="4"></td></tr>');
	}
}


$(document).ready(function() {
    jQuery.getJSON('/api/1/search/crowd?limit=1000', loadData);
    jQuery.postJSON(loadData,'/api/1/search/crowd?limit=1000')
    $(window).resize(onResize());
});
</script>

{% endblock %}

{% block content %}
<table class="mytable">
    <tbody id="dyTableBody">
        <tr><th>Period</th><th>Tweets</th><th>Users</th><th>Star</th></tr>
    </tbody>
</table>
{% endblock %}

